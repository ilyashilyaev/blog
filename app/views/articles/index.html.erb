<% if user_signed_in? %>
  <span><% if current_user.avatar.present? %>
      <%= image_tag(current_user.avatar.thumb.url) %>
      <%end %></span><br>
  <span>Здравствуйте, <%= current_user.email %></span><br>
  <span><%= current_user.nickname %></span>

  <%= link_to 'Edit', edit_user_path(current_user) %>
  <%= link_to 'Выйти', destroy_user_session_path, method: :delete %>
<% else %>
  <%= link_to 'Войти', new_user_session_path %> или <%= link_to 'Зарегистрироваться', new_user_registration_path %>
<% end %>
<p class="notice"><%= notice %></p>
<p class="alert"><%= alert %></p>
<div class="jumbotron text-center">
  <h1>Listing articles</h1>
</div>

<%= link_to 'New article', new_article_path %><br>

<%= form_tag(articles_path, method: "get") do %>
  <%= label_tag(:q, "Search article by title:") %>
  <%= text_field_tag(:q, params[:q]) %>
  <%= submit_tag("Search") %>
<% end %>

<table class="table" id="articles-table">
   <tr>
     <th>ID</th>
     <th>User email</th>
     <th>User IP</th>
     <th>Title</th>
     <th>Text</th>
     <th>Rating</th>
     <th>Show Action</th>
     <th>Edit Action</th>
     <th>Rating Action</th>
     <th>Add Favorites</th>
     <th>Delete</th>
   </tr>
  <% @articles.each do |article| %>
    <tr data-article-id="<%=article.id%>">
      <td><%= article.id %></td>
      <td><%= article.user.email %></td>
      <td><%= article.creator_ip_address %></td>
      <td><%= article.title %></td>
      <td><%= article.text %></td>
      <td><%= article.rating %></td>

      <td><%= link_to 'Show', article_path(article), class: "btn btn-success" %></td>

      <td>
        <% if policy(article).edit? %>
          <%= link_to 'Edit', edit_article_path(article), class: "btn btn-primary" %>
        <% end %>
      </td>

      <td><%= link_to 'Rating', new_article_rating_path(article), class: "btn btn-info" %></td>

      <td>
        <% if article.has_favorite?(current_user)%>
        <button class="delete_favorites">false</button>
          <%else %>
        <button class="btn btn-default favorites" data-article-id="true">true</button>
          <%end %>
      </td>

      <td>
        <% if policy(article).destroy? %>
          <%= link_to 'Delete', 'javascript:void(0)', class: "btn btn-danger" %>
        <% end %>
      </td>
    </tr>
  <% end %>

</table>
<%= paginate @articles %>
<h1>
  List of IP addresses from which several different authors have posted
</h1>

<table class="striped table-bordered">
  <tr>
    <th>IP</th>
    <th>User email</th>
  </tr>
    <% @list_ip.each do |ip, articles| %>
    <tr>
      <td>
        <%= ip %>
      </td>
      <td>
        <% articles.each do |article|   %>
          <p>
            <%= article.user.email %>
          </p>
        <% end %>
      </td>
    </tr>
  <% end %>
</table>
